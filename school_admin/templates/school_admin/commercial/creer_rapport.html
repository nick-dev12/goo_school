<!DOCTYPE html>
{% load static %}
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Créer un rapport - Goo-School Commercial</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{% static 'school_admin/css/commercial/creer_rapport.css' %}"
    />
  </head>
  <body>
    {% include 'school_admin/commercial/partials/header.html' %}

    <div class="page-container">
      <!-- Messages -->
      {% if messages %}
      <div class="message-container">
        {% for message in messages %}
        <div class="message message-{{ message.tags }}">
          <div class="message-content">
            <i
              class="fas fa-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' %}exclamation-circle{% else %}info-circle{% endif %}"
            ></i>
            <span>{{ message }}</span>
          </div>
          <button class="message-close" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <!-- Header de la page -->
      <div class="page-header">
        <div class="header-content">
          <div class="header-info">
            <div class="page-icon">
              <i class="fas fa-file-alt"></i>
            </div>
            <div class="page-details">
              <h1 class="page-title">Créer un rapport de visite</h1>
              <p class="page-subtitle">
                Rapport pour le rendez-vous du {{
                rendez_vous.date_rdv|date:"d/m/Y" }}
              </p>
            </div>
          </div>
          <div class="header-actions">
            <a
              href="{% url 'school_admin:commercial_rendez_vous' %}"
              class="btn btn-outline"
            >
              <i class="fas fa-arrow-left"></i>
              Retour
            </a>
          </div>
        </div>
      </div>

      <!-- Informations du rendez-vous -->
      <div class="rendez-vous-info-section">
        <div class="info-card">
          <h3>Informations du rendez-vous</h3>
          <div class="info-grid">
            <div class="info-item">
              <div class="info-icon">
                <i class="fas fa-building"></i>
              </div>
              <div class="info-content">
                <span class="info-label">Établissement</span>
                <span class="info-value"
                  >{{ etablissement.nom_etablissement }}</span
                >
              </div>
            </div>
            <div class="info-item">
              <div class="info-icon">
                <i class="fas fa-tag"></i>
              </div>
              <div class="info-content">
                <span class="info-label">Type de rendez-vous</span>
                <span class="info-value"
                  >{{ rendez_vous.get_type_rdv_display }}</span
                >
              </div>
            </div>
            <div class="info-item">
              <div class="info-icon">
                <i class="fas fa-calendar"></i>
              </div>
              <div class="info-content">
                <span class="info-label">Date</span>
                <span class="info-value"
                  >{{ rendez_vous.date_rdv|date:"d/m/Y" }}</span
                >
              </div>
            </div>
            <div class="info-item">
              <div class="info-icon">
                <i class="fas fa-clock"></i>
              </div>
              <div class="info-content">
                <span class="info-label">Heure</span>
                <span class="info-value"
                  >{{ rendez_vous.heure_rdv|time:"H:i" }}</span
                >
              </div>
            </div>
            {% if rendez_vous.notes_rdv %}
            <div class="info-item full-width">
              <div class="info-icon">
                <i class="fas fa-sticky-note"></i>
              </div>
              <div class="info-content">
                <span class="info-label">Notes du rendez-vous</span>
                <span class="info-value">{{ rendez_vous.notes_rdv }}</span>
              </div>
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Formulaire de création du rapport -->
      <div class="form-section">
        <div class="form-container">
          <div class="form-header">
            <h2>Rapport de visite</h2>
            <p class="form-subtitle">
              Remplissez les informations sur le déroulement de la visite
            </p>
          </div>
          <form method="post" class="rapport-form">
            {% csrf_token %}

            <div class="form-group">
              <label for="titre" class="form-label">
                Titre du rapport <span class="required">*</span>
              </label>
              <input
                type="text"
                id="titre"
                name="titre"
                class="form-input"
                placeholder="Ex: Rapport de visite - {{ etablissement.nom_etablissement }}"
                value="Rapport de visite - {{ etablissement.nom_etablissement }} - {{ rendez_vous.date_rdv|date:'d/m/Y' }}"
                required
              />
            </div>

            <div class="form-group">
              <label for="contenu" class="form-label">
                Contenu du rapport <span class="required">*</span>
              </label>
              <textarea
                id="contenu"
                name="contenu"
                class="form-textarea"
                rows="6"
                placeholder="Décrivez le déroulement de la visite, les discussions, les points abordés, les décisions prises..."
                required
              ></textarea>
            </div>

            <div class="form-group">
              <label for="satisfaction_client" class="form-label">
                Satisfaction du client <span class="required">*</span>
              </label>
              <select
                id="satisfaction_client"
                name="satisfaction_client"
                class="form-select"
                required
              >
                <option value="">Sélectionner la satisfaction</option>
                <option value="tres_satisfait">Très satisfait</option>
                <option value="satisfait">Satisfait</option>
                <option value="neutre">Neutre</option>
                <option value="peu_satisfait">Peu satisfait</option>
                <option value="pas_satisfait">Pas satisfait</option>
              </select>
            </div>

            <div class="form-actions">
              <a
                href="{% url 'school_admin:commercial_rendez_vous' %}"
                class="btn btn-outline"
              >
                <i class="fas fa-times"></i>
                Annuler
              </a>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i>
                Créer le rapport
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      // Auto-close messages
      document.addEventListener("DOMContentLoaded", function () {
        const messages = document.querySelectorAll(".message");
        messages.forEach((message) => {
          setTimeout(() => {
            if (message.parentElement) {
              message.style.animation = "slideOutRight 0.3s ease";
              setTimeout(() => {
                if (message.parentElement) {
                  message.remove();
                }
              }, 300);
            }
          }, 4000);
        });
      });
    </script>
  </body>
</html>
