

<!DOCTYPE html>
{% load static %}
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inscription des Élèves - {{ etablissement.nom }}</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{% static 'school_admin/css/directeur/header_secretaire.css' %}"
    />
    <link
      rel="stylesheet"
      href="{% static 'school_admin/css/directeur/inscription_eleves.css' %}"
    />
    <link
      rel="stylesheet"
      href="{% static 'school_admin/css/partials/messages.css' %}"
    />
  </head>
  <body>
    <!-- Header -->
    {% if user.is_authenticated %}
        {% if user.directeur_prenom %}
            {% include 'school_admin/directeur/partials/header_directeur.html' %}
        {% else %}
            {% include 'school_admin/directeur/secretaire/partials/header_secretaire.html' %}
        {% endif %}
    {% else %}
        {% include 'school_admin/directeur/secretaire/partials/header_secretaire.html' %}
    {% endif %}

    <!-- Main Content Container -->
    <div class="container">
      <!-- Page Header -->
      <div class="page-header">
        <div class="page-title-section">
          <h1 class="page-title">
            <i class="fas fa-user-graduate"></i>
            Inscription des Élèves
          </h1>
          <p class="page-subtitle">
            Enregistrer de nouveaux élèves dans {{ etablissement.nom }}
          </p>
        </div>
        <div class="page-actions">
          <a href="{% url 'secretaire:dashboard_secretaire' %}" class="btn-secondary">
            <i class="fas fa-arrow-left"></i>
            <span>Retour au tableau de bord</span>
          </a>
        </div>
      </div>

      <!-- Messages Django -->
      {% include 'school_admin/partials/messages.html' %}

      <!-- Indicateur d'étapes -->
      <div class="form-steps-indicator">
        <div class="step-indicator active">
          <div class="step-number">1</div>
          <span>Informations personnelles</span>
        </div>
        <div class="step-separator"></div>
        <div class="step-indicator active">
          <div class="step-number">2</div>
          <span>Informations scolaires</span>
        </div>
        <div class="step-separator"></div>
        <div class="step-indicator active">
          <div class="step-number">3</div>
          <span>Parents/Tuteur</span>
        </div>
        <div class="step-separator"></div>
        <div class="step-indicator active">
          <div class="step-number">4</div>
          <span>Documents</span>
        </div>
      </div>

      <!-- Formulaire d'inscription -->
      <div class="inscription-container">
        <div class="inscription-form-card">
          <div class="form-header">
            <h2 class="form-title">
              <i class="fas fa-user-plus"></i>
              Informations de l'élève
            </h2>
            <p class="form-subtitle">Remplissez les informations requises pour inscrire un nouvel élève</p>
          </div>

          <form method="post" action="{% url 'secretaire:inscription_eleves' %}" class="inscription-form" id="inscriptionForm">
            {% csrf_token %}
            
            <!-- Étape 1: Informations personnelles -->
            <div class="form-section" data-step="1">
              <h3 class="section-title">
                <i class="fas fa-user"></i>
                Informations personnelles
              </h3>
              
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label" for="nom">Nom de famille *</label>
                  <input type="text" 
                         class="form-control {% if field_errors.nom %}is-invalid{% endif %}" 
                         id="nom" 
                         name="nom" 
                         value="{{ form_data.nom }}"
                         placeholder="Ex: Dupont"
                         required>
                  {% if field_errors.nom %}
                    <div class="invalid-feedback">{{ field_errors.nom }}</div>
                  {% endif %}
                </div>
                
                <div class="form-group">
                  <label class="form-label" for="prenom">Prénom *</label>
                  <input type="text" 
                         class="form-control {% if field_errors.prenom %}is-invalid{% endif %}" 
                         id="prenom" 
                         name="prenom" 
                         value="{{ form_data.prenom }}"
                         placeholder="Ex: Marie"
                         required>
                  {% if field_errors.prenom %}
                    <div class="invalid-feedback">{{ field_errors.prenom }}</div>
                  {% endif %}
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label" for="date_naissance">Date de naissance *</label>
                  <input type="date" 
                         class="form-control {% if field_errors.date_naissance %}is-invalid{% endif %}" 
                         id="date_naissance" 
                         name="date_naissance" 
                         value="{{ form_data.date_naissance }}"
                         required>
                  {% if field_errors.date_naissance %}
                    <div class="invalid-feedback">{{ field_errors.date_naissance }}</div>
                  {% endif %}
                </div>
                
                <div class="form-group">
                  <label class="form-label" for="lieu_naissance">Lieu de naissance *</label>
                  <input type="text" 
                         class="form-control {% if field_errors.lieu_naissance %}is-invalid{% endif %}" 
                         id="lieu_naissance" 
                         name="lieu_naissance" 
                         value="{{ form_data.lieu_naissance }}"
                         placeholder="Ex: Paris"
                         required>
                  {% if field_errors.lieu_naissance %}
                    <div class="invalid-feedback">{{ field_errors.lieu_naissance }}</div>
                  {% endif %}
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label" for="sexe">Sexe *</label>
                  <select class="form-control {% if field_errors.sexe %}is-invalid{% endif %}" id="sexe" name="sexe" required>
                    <option value="">Sélectionnez le sexe</option>
                    <option value="M" {% if form_data.sexe == 'M' %}selected{% endif %}>Masculin</option>
                    <option value="F" {% if form_data.sexe == 'F' %}selected{% endif %}>Féminin</option>
                  </select>
                  {% if field_errors.sexe %}
                    <div class="invalid-feedback">{{ field_errors.sexe }}</div>
                  {% endif %}
                </div>
                
                <div class="form-group">
                  <label class="form-label" for="nationalite">Nationalité *</label>
                  <input type="text" 
                         class="form-control {% if field_errors.nationalite %}is-invalid{% endif %}" 
                         id="nationalite" 
                         name="nationalite" 
                         value="{{ form_data.nationalite }}"
                         placeholder="Ex: Française"
                         required>
                  {% if field_errors.nationalite %}
                    <div class="invalid-feedback">{{ field_errors.nationalite }}</div>
                   {% endif %}
                 </div>
               </div>

               <!-- Informations de contact (optionnelles) -->
               <div class="form-row">
                 <div class="form-group">
                   <label class="form-label" for="adresse">Adresse de résidence <span class="optional-label">(optionnel)</span></label>
                   <textarea class="form-control {% if field_errors.adresse %}is-invalid{% endif %}" 
                             id="adresse" 
                             name="adresse" 
                             rows="3"
                             placeholder="Adresse complète de résidence (optionnel)">{{ form_data.adresse }}</textarea>
                   {% if field_errors.adresse %}
                     <div class="invalid-feedback">{{ field_errors.adresse }}</div>
                   {% endif %}
                 </div>
               </div>

               <div class="form-row">
                 <div class="form-group">
                   <label class="form-label" for="telephone">Téléphone de l'élève <span class="optional-label">(optionnel)</span></label>
                   <input type="tel" 
                          class="form-control {% if field_errors.telephone %}is-invalid{% endif %}" 
                          id="telephone" 
                          name="telephone" 
                          value="{{ form_data.telephone }}"
                          placeholder="Numéro de téléphone de l'élève (optionnel)">
                   {% if field_errors.telephone %}
                     <div class="invalid-feedback">{{ field_errors.telephone }}</div>
                   {% endif %}
                 </div>
                 
                 <div class="form-group">
                   <label class="form-label" for="email">Email de l'élève <span class="optional-label">(optionnel)</span></label>
                   <input type="email" 
                          class="form-control {% if field_errors.email %}is-invalid{% endif %}" 
                          id="email" 
                          name="email" 
                          value="{{ form_data.email }}"
                          placeholder="Adresse email de l'élève (optionnel)">
                   {% if field_errors.email %}
                     <div class="invalid-feedback">{{ field_errors.email }}</div>
                   {% endif %}
                 </div>
               </div>
             </div>

            <!-- Étape 2: Informations scolaires -->
            <div class="form-section" data-step="2">
              <h3 class="section-title">
                <i class="fas fa-graduation-cap"></i>
                Informations scolaires
              </h3>
              
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label" for="classe">Classe d'affectation *</label>
                  <select class="form-control {% if field_errors.classe %}is-invalid{% endif %}" id="classe" name="classe" required>
                    <option value="">Sélectionnez une classe</option>
                    {% for classe in classes %}
                      <option value="{{ classe.id }}" {% if form_data.classe == classe.id|stringformat:"s" %}selected{% endif %}>
                        {{ classe.nom }} ({{ classe.get_niveau_display }})
                      </option>
                    {% endfor %}
                  </select>
                  {% if field_errors.classe %}
                    <div class="invalid-feedback">{{ field_errors.classe }}</div>
                  {% endif %}
                </div>
                
                <div class="form-group">
                  <label class="form-label" for="date_inscription">Date d'inscription *</label>
                  <input type="date" 
                         class="form-control {% if field_errors.date_inscription %}is-invalid{% endif %}" 
                         id="date_inscription" 
                         name="date_inscription" 
                         value="{{ form_data.date_inscription }}"
                         required>
                  {% if field_errors.date_inscription %}
                    <div class="invalid-feedback">{{ field_errors.date_inscription }}</div>
                  {% endif %}
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label" for="statut">Type d'inscription *</label>
                  <select class="form-control {% if field_errors.statut %}is-invalid{% endif %}" id="statut" name="statut" required>
                    <option value="">Sélectionnez un type</option>
                    <option value="nouvelle" {% if form_data.statut == 'nouvelle' %}selected{% endif %}>Nouvelle inscription</option>
                    <option value="transfert" {% if form_data.statut == 'transfert' %}selected{% endif %}>Transfert d'établissement</option>
                    <option value="reinscription" {% if form_data.statut == 'reinscription' %}selected{% endif %}>Réinscription</option>
                  </select>
                  {% if field_errors.statut %}
                    <div class="invalid-feedback">{{ field_errors.statut }}</div>
                  {% endif %}
                </div>
                
                <div class="form-group">
                  <label class="form-label" for="numero_eleve">Numéro d'élève</label>
                  <input type="text" 
                         class="form-control {% if field_errors.numero_eleve %}is-invalid{% endif %}" 
                         id="numero_eleve" 
                         name="numero_eleve" 
                         value="{{ form_data.numero_eleve }}"
                         placeholder="Généré automatiquement côté serveur"
                         readonly>
                  {% if field_errors.numero_eleve %}
                    <div class="invalid-feedback">{{ field_errors.numero_eleve }}</div>
                  {% endif %}
                  <small class="form-text text-muted">
                    <i class="fas fa-info-circle"></i>
                    Le numéro d'élève est généré automatiquement côté serveur
                  </small>
                </div>
              </div>
            </div>

            <!-- Étape 3: Informations du parent/tuteur -->
            <div class="form-section" data-step="3">
              <h3 class="section-title">
                <i class="fas fa-user-friends"></i>
                Informations du parent/tuteur
              </h3>
              
              <!-- Instructions -->
              <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <strong>Instructions :</strong> Remplissez les informations de la personne responsable de l'élève (parent, tuteur légal, etc.).
              </div>

              <!-- Champs du parent/tuteur -->
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label" for="parent_nom">Nom du parent/tuteur <span class="required-label">*</span></label>
                  <input type="text" 
                         class="form-control {% if field_errors.parent_nom %}is-invalid{% endif %}" 
                         id="parent_nom" 
                         name="parent_nom" 
                         value="{{ form_data.parent_nom }}"
                         placeholder="Nom de famille du parent/tuteur"
                         required>
                  {% if field_errors.parent_nom %}
                    <div class="invalid-feedback">{{ field_errors.parent_nom }}</div>
                  {% endif %}
                </div>
                
                <div class="form-group">
                  <label class="form-label" for="parent_prenom">Prénom du parent/tuteur <span class="required-label">*</span></label>
                  <input type="text" 
                         class="form-control {% if field_errors.parent_prenom %}is-invalid{% endif %}" 
                         id="parent_prenom" 
                         name="parent_prenom" 
                         value="{{ form_data.parent_prenom }}"
                         placeholder="Prénom du parent/tuteur"
                         required>
                  {% if field_errors.parent_prenom %}
                    <div class="invalid-feedback">{{ field_errors.parent_prenom }}</div>
                  {% endif %}
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label" for="parent_telephone">Téléphone du parent/tuteur <span class="required-label">*</span></label>
                  <input type="tel" 
                         class="form-control {% if field_errors.parent_telephone %}is-invalid{% endif %}" 
                         id="parent_telephone" 
                         name="parent_telephone" 
                         value="{{ form_data.parent_telephone }}"
                         placeholder="Téléphone du parent/tuteur"
                         required>
                  {% if field_errors.parent_telephone %}
                    <div class="invalid-feedback">{{ field_errors.parent_telephone }}</div>
                  {% endif %}
                </div>
                
                <div class="form-group">
                  <label class="form-label" for="parent_email">Email du parent/tuteur <span class="optional-label">(optionnel)</span></label>
                  <input type="email" 
                         class="form-control {% if field_errors.parent_email %}is-invalid{% endif %}" 
                         id="parent_email" 
                         name="parent_email" 
                         value="{{ form_data.parent_email }}"
                         placeholder="Email du parent/tuteur (optionnel)">
                  {% if field_errors.parent_email %}
                    <div class="invalid-feedback">{{ field_errors.parent_email }}</div>
                  {% endif %}
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label" for="parent_profession">Profession du parent/tuteur <span class="optional-label">(optionnel)</span></label>
                  <input type="text" 
                         class="form-control {% if field_errors.parent_profession %}is-invalid{% endif %}" 
                         id="parent_profession" 
                         name="parent_profession" 
                         value="{{ form_data.parent_profession }}"
                         placeholder="Profession du parent/tuteur (optionnel)">
                  {% if field_errors.parent_profession %}
                    <div class="invalid-feedback">{{ field_errors.parent_profession }}</div>
                  {% endif %}
                </div>
                
                <div class="form-group">
                  <label class="form-label" for="parent_lien">Lien avec l'élève <span class="required-label">*</span></label>
                  <select class="form-control {% if field_errors.parent_lien %}is-invalid{% endif %}" 
                          id="parent_lien" 
                          name="parent_lien" 
                          required>
                    <option value="">Sélectionner le lien</option>
                    <option value="pere" {% if form_data.parent_lien == 'pere' %}selected{% endif %}>Père</option>
                    <option value="mere" {% if form_data.parent_lien == 'mere' %}selected{% endif %}>Mère</option>
                    <option value="grand_parent" {% if form_data.parent_lien == 'grand_parent' %}selected{% endif %}>Grand-parent</option>
                    <option value="oncle_tante" {% if form_data.parent_lien == 'oncle_tante' %}selected{% endif %}>Oncle/Tante</option>
                    <option value="frere_soeur" {% if form_data.parent_lien == 'frere_soeur' %}selected{% endif %}>Frère/Sœur</option>
                    <option value="autre_famille" {% if form_data.parent_lien == 'autre_famille' %}selected{% endif %}>Autre membre de la famille</option>
                    <option value="tuteur_legal" {% if form_data.parent_lien == 'tuteur_legal' %}selected{% endif %}>Tuteur légal</option>
                    <option value="autre" {% if form_data.parent_lien == 'autre' %}selected{% endif %}>Autre</option>
                  </select>
                  {% if field_errors.parent_lien %}
                    <div class="invalid-feedback">{{ field_errors.parent_lien }}</div>
                  {% endif %}
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label" for="parent_adresse">Adresse du parent/tuteur <span class="optional-label">(optionnel)</span></label>
                  <textarea class="form-control {% if field_errors.parent_adresse %}is-invalid{% endif %}" 
                            id="parent_adresse" 
                            name="parent_adresse" 
                            rows="3"
                            placeholder="Adresse complète du parent/tuteur (optionnel)">{{ form_data.parent_adresse }}</textarea>
                  {% if field_errors.parent_adresse %}
                    <div class="invalid-feedback">{{ field_errors.parent_adresse }}</div>
                  {% endif %}
                </div>
              </div>

              <!-- Mot de passe provisoire (généré automatiquement) -->
              <div class="password-section">
                <div class="password-info">
                  <div class="password-icon">
                    <i class="fas fa-key"></i>
                  </div>
                  <div class="password-content">
                    <h4 class="password-title">Mot de passe provisoire</h4>
                    <p class="password-description">
                      Un mot de passe provisoire de 4 chiffres sera généré automatiquement côté serveur pour permettre au parent/tuteur d'accéder au portail de l'établissement.
                    </p>
                    <div class="password-display">
                      <span class="password-label">Mot de passe généré :</span>
                      <span class="password-value">{{ form_data.mot_de_passe_provisoire|default:"Génération côté serveur..." }}</span>
                    </div>
                  </div>
                </div>
                
                <!-- Champ caché pour le mot de passe -->
                <input type="hidden" id="mot_de_passe_provisoire" name="mot_de_passe_provisoire" value="{{ form_data.mot_de_passe_provisoire|default:'' }}">
              </div>
            </div>

            <!-- Étape 4: Validation des documents -->
            <div class="form-section" data-step="4">
              <h3 class="section-title">
                <i class="fas fa-file-check"></i>
                Validation des documents
              </h3>
                
                <div class="documents-grid">
                  <div class="document-category">
                    <h4 class="category-title">Documents d'identité</h4>
                    <div class="checkbox-group">
                      <label class="checkbox-option">
                        <input type="checkbox" name="document_acte_naissance" value="true" {% if form_data.document_acte_naissance %}checked{% endif %}>
                        <span class="checkbox-label">Acte de naissance</span>
                      </label>
                      <label class="checkbox-option">
                        <input type="checkbox" name="document_cni" value="true" {% if form_data.document_cni %}checked{% endif %}>
                        <span class="checkbox-label">Carte nationale d'identité</span>
                      </label>
                      <label class="checkbox-option">
                        <input type="checkbox" name="document_passeport" value="true" {% if form_data.document_passeport %}checked{% endif %}>
                        <span class="checkbox-label">Passeport</span>
                      </label>
                    </div>
                  </div>
                  
                  <div class="document-category">
                    <h4 class="category-title">Documents scolaires</h4>
                    <div class="checkbox-group">
                      <label class="checkbox-option">
                        <input type="checkbox" name="document_bulletin_precedent" value="true" {% if form_data.document_bulletin_precedent %}checked{% endif %}>
                        <span class="checkbox-label">Bulletin de l'année précédente</span>
                      </label>
                      <label class="checkbox-option">
                        <input type="checkbox" name="document_certificat_scolarite" value="true" {% if form_data.document_certificat_scolarite %}checked{% endif %}>
                        <span class="checkbox-label">Certificat de scolarité</span>
                      </label>
                      <label class="checkbox-option">
                        <input type="checkbox" name="document_livret_scolaire" value="true" {% if form_data.document_livret_scolaire %}checked{% endif %}>
                        <span class="checkbox-label">Livret scolaire</span>
                      </label>
                    </div>
                  </div>
                  
                  <div class="document-category">
                    <h4 class="category-title">Documents médicaux</h4>
                    <div class="checkbox-group">
                      <label class="checkbox-option">
                        <input type="checkbox" name="document_certificat_medical" value="true" {% if form_data.document_certificat_medical %}checked{% endif %}>
                        <span class="checkbox-label">Certificat médical</span>
                      </label>
                      <label class="checkbox-option">
                        <input type="checkbox" name="document_carnet_vaccination" value="true" {% if form_data.document_carnet_vaccination %}checked{% endif %}>
                        <span class="checkbox-label">Carnet de vaccination</span>
                      </label>
                      <label class="checkbox-option">
                        <input type="checkbox" name="document_assurance_maladie" value="true" {% if form_data.document_assurance_maladie %}checked{% endif %}>
                        <span class="checkbox-label">Attestation d'assurance maladie</span>
                      </label>
                    </div>
                  </div>
                  
                  <div class="document-category">
                    <h4 class="category-title">Documents administratifs</h4>
                    <div class="checkbox-group">
                      <label class="checkbox-option">
                        <input type="checkbox" name="document_justificatif_domicile" value="true" {% if form_data.document_justificatif_domicile %}checked{% endif %}>
                        <span class="checkbox-label">Justificatif de domicile</span>
                      </label>
                      <label class="checkbox-option">
                        <input type="checkbox" name="document_photo_identite" value="true" {% if form_data.document_photo_identite %}checked{% endif %}>
                        <span class="checkbox-label">Photo d'identité</span>
                      </label>
                      <label class="checkbox-option">
                        <input type="checkbox" name="document_autorisation_parentale" value="true" {% if form_data.document_autorisation_parentale %}checked{% endif %}>
                        <span class="checkbox-label">Autorisation parentale</span>
                      </label>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Actions du formulaire -->
            <div class="form-actions">
                <button type="button" class="btn-secondary" onclick="resetForm()">
                  <i class="fas fa-undo"></i>
                  <span>Réinitialiser</span>
                </button>
                <button type="submit" class="btn-primary">
                  <i class="fas fa-save"></i>
                  <span>Inscrire l'élève</span>
                </button>
              </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Script pour animations -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {

        // Animation d'apparition progressive des champs
        const formGroups = document.querySelectorAll('.form-group');
        formGroups.forEach((group, index) => {
          group.style.opacity = '0';
          group.style.transform = 'translateY(10px)';
          
          setTimeout(() => {
            group.style.transition = 'all 0.3s ease';
            group.style.opacity = '1';
            group.style.transform = 'translateY(0)';
          }, index * 50);
        });

        // Effet de focus amélioré sur les champs
        const formControls = document.querySelectorAll('.form-control');
        formControls.forEach(control => {
          control.addEventListener('focus', function() {
            this.parentElement.style.transform = 'scale(1.02)';
            this.parentElement.style.transition = 'transform 0.2s ease';
          });
          
          control.addEventListener('blur', function() {
            this.parentElement.style.transform = 'scale(1)';
          });
        });

      });

      function resetForm() {
        if (confirm('Êtes-vous sûr de vouloir réinitialiser le formulaire ?')) {
          // Animation de réinitialisation
          const form = document.getElementById('inscriptionForm');
          form.style.opacity = '0.5';
          form.style.transform = 'scale(0.98)';
          
          setTimeout(() => {
            form.reset();
            
            // Animation de retour
            form.style.transition = 'all 0.3s ease';
            form.style.opacity = '1';
            form.style.transform = 'scale(1)';
          }, 200);
        }
      }
    </script>
  </body>
</html>
