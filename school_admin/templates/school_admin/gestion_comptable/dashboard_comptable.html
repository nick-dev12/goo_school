{% load static %}
<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Gestion Comptable - Goo-School{% endblock %}</title>
    <link
      rel="stylesheet"
      href="{% static 'school_admin/css/gestion_comptable/dashboard_comptable.css' %}"
    />
    <link
      rel="stylesheet"
      href="{% static 'school_admin/css/gestion_comptable/header_comptable.css' %}"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body>
    {% include 'school_admin/gestion_comptable/partials/header_comptable.html'%}

    <!-- Dashboard Content -->
    <div class="dashboard-content">
      <!-- KPIs Section -->
      <div class="kpis-section">
        <div class="kpi-card">
          <div class="kpi-icon purple">
            <i class="fas fa-graduation-cap"></i>
          </div>
          <div class="kpi-content">
            <h3>{{ total_etablissements }}</h3>
            <p>Écoles actives</p>
            <span class="kpi-trend positive">+2 ce mois</span>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-icon green">
            <i class="fas fa-users"></i>
          </div>
          <div class="kpi-content">
            <h3>{{ total_eleves|floatformat:0 }}</h3>
            <p>Total élèves</p>
            <span class="kpi-trend positive">+12% ce mois</span>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-icon purple">
            <i class="fas fa-euro-sign"></i>
          </div>
          <div class="kpi-content">
            <h3>{{ revenus_collectes|floatformat:0 }} FCFA</h3>
            <p>Revenus totaux</p>
            <span class="kpi-trend positive">+8% ce mois</span>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-icon orange">
            <i class="fas fa-clock"></i>
          </div>
          <div class="kpi-content">
            <h3>{{ montants_en_attente|floatformat:0 }} FCFA</h3>
            <p>En attente</p>
            <span class="kpi-trend warning">{{ inscriptions_retard }} inscriptions en retard</span>
          </div>
        </div>
      </div>

      <!-- Main Content Grid -->
      <div class="main-grid">
        <!-- Left Column -->
        <div class="left-column">
          <!-- Vue Financière -->
          <div class="card financial-view">
            <div class="card-header">
              <h2><i class="fas fa-euro-sign"></i> Vue financière</h2>
            </div>
            <div class="card-content">
              <div class="financial-metrics">
                <div class="metric">
                  <h3 class="metric-value green">{{ revenus_collectes|floatformat:0 }} FCFA</h3>
                  <p class="metric-label">Revenus collectés</p>
                </div>
                <div class="metric">
                  <h3 class="metric-value orange">{{ montants_en_attente|floatformat:0 }} FCFA</h3>
                  <p class="metric-label">En attente</p>
                </div>
                <div class="metric">
                  <h3 class="metric-value blue">{{ montants_en_retard|floatformat:0 }} FCFA</h3>
                  <p class="metric-label">En retard</p>
                </div>
              </div>

              <div class="collection-rate">
                <div class="rate-info">
                  <p>{{ revenus_collectes|floatformat:0 }} FCFA collectés sur {{ montant_total_attendu|floatformat:0 }} FCFA attendus</p>
                  <span class="rate-trend positive"
                    >+12% par rapport au mois dernier</span
                  >
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: {{ taux_collecte }}%"></div>
                </div>
                <div class="rate-percentage">{{ taux_collecte }}%</div>
              </div>
            </div>
          </div>

          <!-- État des écoles -->
          <div class="card schools-status">
            <div class="card-header">
              <h2><i class="fas fa-graduation-cap"></i> État des écoles ({{ total_etablissements }})</h2>
            </div>
            <div class="card-content">
              <div class="schools-list">
                {% for stat in etablissements_stats %}
                <div class="school-item">
                  <div class="school-info">
                    <h4>{{ stat.etablissement.nom }}</h4>
                    <p>{{ stat.nombre_eleves }} élèves • {{ stat.montant_total|floatformat:0 }} FCFA</p>
                  </div>
                  <div class="school-status">
                    <span class="status-badge active">Actif</span>
                    {% if stat.montant_du > 0 %}
                    <span class="amount-due">{{ stat.montant_du|floatformat:0 }} FCFA dû</span>
                    {% endif %}
                  </div>
                </div>
                {% empty %}
                <div class="school-item">
                  <div class="school-info">
                    <h4>Aucun établissement actif</h4>
                    <p>Veuillez ajouter des établissements pour voir les statistiques</p>
                  </div>
                </div>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>

        <!-- Right Column -->
        <div class="right-column">
          <!-- Activité récente -->
          <div class="card recent-activity">
            <div class="card-header">
              <h2><i class="fas fa-chart-line"></i> Activité récente</h2>
            </div>
            <div class="card-content">
              <div class="activity-list">
                {% for activite in activites_recentes %}
                <div class="activity-item">
                  <div class="activity-icon {% if activite.statut == 'paye' %}green{% elif activite.statut == 'en_attente' %}orange{% else %}red{% endif %}">
                    <i class="fas fa-{% if activite.statut == 'paye' %}arrow-up{% else %}clock{% endif %}"></i>
                  </div>
                  <div class="activity-info">
                    <h4>{{ activite.etablissement.nom }}</h4>
                    <p>{{ activite.date_creation|date:"d M" }} • {{ activite.montant_total|floatformat:0 }} FCFA</p>
                  </div>
                  <span class="status-badge {% if activite.statut == 'paye' %}completed{% elif activite.statut == 'en_attente' %}pending{% else %}delayed{% endif %}">
                    {{ activite.get_statut_display }}
                  </span>
                </div>
                {% empty %}
                <div class="activity-item">
                  <div class="activity-info">
                    <h4>Aucune activité récente</h4>
                    <p>Les activités de facturation apparaîtront ici</p>
                  </div>
                </div>
                {% endfor %}
              </div>
            </div>
          </div>

          <!-- Inscriptions en retard -->
          <div class="card delayed-registrations">
            <div class="card-header warning">
              <h2>
                <i class="fas fa-exclamation-triangle"></i> Inscriptions en
                retard
              </h2>
            </div>
            <div class="card-content">
              <p>{{ inscriptions_retard }} école{% if inscriptions_retard > 1 %}s{% endif %} {% if inscriptions_retard > 1 %}ont{% else %}a{% endif %} des inscriptions en retard</p>
              {% if inscriptions_retard > 0 %}
              <button class="action-btn">Action requise</button>
              {% endif %}
            </div>
          </div>

          <!-- Personnel -->
          <div class="card personnel">
            <div class="card-header">
              <h2><i class="fas fa-users"></i> Personnel</h2>
            </div>
            <div class="card-content">
              <div class="personnel-metrics">
                <div class="metric">
                  <h3>{{ personnel_actif }}</h3>
                  <p>Employés actifs</p>
                </div>
                <div class="metric">
                  <h3>{{ personnel_total }}</h3>
                  <p>Total employés</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Bénéfices -->
          <div class="card benefits">
            <div class="card-header">
              <h2><i class="fas fa-chart-pie"></i> Bénéfices</h2>
            </div>
            <div class="card-content">
              <div class="benefit-info">
                <h3 class="benefit-amount">{{ benefices_estimes|floatformat:0 }} FCFA</h3>
                <p>Total des bénéfices</p>
                <span class="benefit-trend positive">+15% ce mois</span>
              </div>
            </div>
          </div>

          <!-- Paiements personnel -->
          <div class="card personnel-payments">
            <div class="card-header">
              <h2><i class="fas fa-credit-card"></i> Paiements personnel</h2>
            </div>
            <div class="card-content">
              <div class="payment-info">
                <h3>{{ paiements_personnel.montant_total|floatformat:0 }} FCFA</h3>
                <p>Montant total</p>
                <div class="payment-dates">
                  <p><strong>Dernier paiement:</strong> {{ paiements_personnel.dernier_paiement }}</p>
                  <p><strong>Prochain paiement:</strong> {{ paiements_personnel.prochain_paiement }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="{% static 'school_admin/js/gestion_comptable/dashboard_comptable.js' %}"></script>
  </body>
</html>
