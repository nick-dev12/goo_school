{% extends 'school_admin/base.html' %}
{% load static %}

{% block title %}Inscription Goo-school {% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'school_admin/css/inscription_admin.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<div class="inscription-container">
    <div class="inscription-card">
        <div class="card-header">
            <div class="logo">
                <i class="fas fa-shield-alt"></i>
            </div>
            <h1>Inscription Goo-school</h1>
            <p>Ajouter un compte  Goo-school</p>
        </div>

        <div class="card-body">
            <!-- Messages Flash -->
            {% if messages %}
                <div class="messages-container">
                    {% for message in messages %}
                        <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">
                            {% if message.tags == 'success' %}
                                <i class="fas fa-check-circle"></i>
                            {% elif message.tags == 'error' %}
                                <i class="fas fa-exclamation-circle"></i>
                            {% elif message.tags == 'warning' %}
                                <i class="fas fa-exclamation-triangle"></i>
                            {% else %}
                                <i class="fas fa-info-circle"></i>
                            {% endif %}
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

            <!-- Indicateur d'étapes -->
            <div class="steps-indicator">
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">Informations personnelles</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">Informations professionnelles & Sécurité</div>
                </div>
            </div>

            <form id="admin-registration-form" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                
                <!-- Étape 1: Informations personnelles -->
                <div class="form-step active" data-step="1">
                    <div class="form-section">
                        <h3><i class="fas fa-user-circle"></i> Informations personnelles</h3>
                        
                        <div class="form-row">
                            <div class="form-group {% if field_errors.nom %}has-error{% endif %}">
                                <label for="nom">Nom <span class="required">*</span></label>
                                <input type="text" id="nom" name="nom" value="{{ form_data.nom }}" required>
                                {% if field_errors.nom %}
                                    <span class="error-message">{{ field_errors.nom }}</span>
                                {% endif %}
                            </div>
                            <div class="form-group {% if field_errors.prenom %}has-error{% endif %}">
                                <label for="prenom">Prénom <span class="required">*</span></label>
                                <input type="text" id="prenom" name="prenom" value="{{ form_data.prenom }}" required>
                                {% if field_errors.prenom %}
                                    <span class="error-message">{{ field_errors.prenom }}</span>
                                {% endif %}
                            </div>
                        </div>

                        <div class="form-group {% if field_errors.email %}has-error{% endif %}">
                            <label for="email">Email professionnel <span class="required">*</span></label>
                            <input type="email" id="email" name="email" value="{{ form_data.email }}" required>
                            {% if field_errors.email %}
                                <span class="error-message">{{ field_errors.email }}</span>
                            {% endif %}
                        </div>

                        <div class="form-row">
                            <div class="form-group {% if field_errors.telephone %}has-error{% endif %}">
                                <label for="telephone">Téléphone <span class="required">*</span></label>
                                <input type="tel" id="telephone" name="telephone" value="{{ form_data.telephone }}" required>
                                {% if field_errors.telephone %}
                                    <span class="error-message">{{ field_errors.telephone }}</span>
                                {% endif %}
                            </div>
                            <div class="form-group {% if field_errors.date_naissance %}has-error{% endif %}">
                                <label for="date_naissance">Date de naissance <span class="required">*</span></label>
                                <input type="date" id="date_naissance" name="date_naissance" value="{{ form_data.date_naissance }}" required>
                                {% if field_errors.date_naissance %}
                                    <span class="error-message">{{ field_errors.date_naissance }}</span>
                                {% endif %}
                            </div>
                        </div>

                        <div class="form-group {% if field_errors.photo %}has-error{% endif %}">
                            <label for="photo">Photo de profil</label>
                            <div class="file-upload">
                                <input type="file" id="photo" name="photo" accept="image/*">
                                <span class="file-label">
                                    <i class="fas fa-cloud-upload-alt"></i> Choisir une image
                                </span>
                                <span id="file-name">Aucun fichier sélectionné</span>
                            </div>
                            {% if field_errors.photo %}
                                <span class="error-message">{{ field_errors.photo }}</span>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Étape 2: Informations professionnelles -->
                <div class="form-step" data-step="2">
                    <div class="form-section">
                        <h3><i class="fas fa-briefcase"></i> Informations professionnelles</h3>
                        
                        <div class="form-row">
                            <div class="form-group {% if field_errors.type_compte %}has-error{% endif %}">
                                <label for="type_compte">Type de compte <span class="required">*</span></label>
                                <select id="type_compte" name="type_compte" required>
                                    <option value="" {% if not form_data.type_compte %}selected{% endif %}>Sélectionnez un type</option>
                                    <option value="administrateur" {% if form_data.type_compte == 'administrateur' %}selected{% endif %}>administrateur</option>
                                    <option value="membre" {% if form_data.type_compte == 'membre' %}selected{% endif %}>Membre de l'équipe</option>
                                </select>
                                {% if field_errors.type_compte %}
                                    <span class="error-message">{{ field_errors.type_compte }}</span>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="form-group {% if field_errors.departement %}has-error{% endif %}">
                            <label for="departement">Département <span class="required">*</span></label>
                            <select id="departement" name="departement" required>
                                <option value="" {% if not form_data.departement %}selected{% endif %}>Sélectionnez un département</option>
                                <option value="technique" {% if form_data.departement == 'technique' %}selected{% endif %}>Technique</option>
                                <option value="support" {% if form_data.departement == 'support' %}selected{% endif %}>Support Client</option>
                                <option value="commercial" {% if form_data.departement == 'commercial' %}selected{% endif %}>Commercial & Ventes</option>
                                <option value="marketing" {% if form_data.departement == 'marketing' %}selected{% endif %}>Marketing</option>
                                <option value="direction" {% if form_data.departement == 'direction' %}selected{% endif %}>Direction</option>
                                <option value="comptable" {% if form_data.departement == 'comptable' %}selected{% endif %}>Comptable</option>
                                <option value="ressources humaines" {% if form_data.departement == 'ressources humaines' %}selected{% endif %}>Ressources humaines</option>
                            </select>
                            {% if field_errors.departement %}
                                <span class="error-message">{{ field_errors.departement }}</span>
                            {% endif %}
                        </div>

                        <div class="form-group {% if field_errors.fonction %}has-error{% endif %}">
                            <label for="fonction">Fonction <span class="required">*</span></label>
                            <select id="fonction" name="fonction" required>
                                <option value="" {% if not form_data.fonction %}selected{% endif %}>Sélectionnez une fonction</option>
                                <option value="commercial" {% if form_data.fonction == 'commercial' %}selected{% endif %}>Commercial</option>
                                <option value="support" {% if form_data.fonction == 'support' %}selected{% endif %}>Support Client</option>
                                <option value="developpeur" {% if form_data.fonction == 'developpeur' %}selected{% endif %}>Développeur</option>
                                <option value="marketing" {% if form_data.fonction == 'marketing' %}selected{% endif %}>Marketing</option>
                                <option value="administrateur" {% if form_data.fonction == 'administrateur' %}selected{% endif %}>Administrateur</option>
                                <option value="comptable" {% if form_data.fonction == 'comptable' %}selected{% endif %}>Comptable</option>
                                <option value="ressources humaines" {% if form_data.fonction == 'ressources humaines' %}selected{% endif %}>Ressources humaines</option>
                            </select>
                            {% if field_errors.fonction %}
                                <span class="error-message">{{ field_errors.fonction }}</span>
                            {% endif %}
                        </div>
                        

                        <div class="form-row">
                            <div class="form-group {% if field_errors.password %}has-error{% endif %}">
                                <label for="password">Mot de passe <span class="required">*</span></label>
                                <div class="password-container">
                                    <input type="password" id="password" name="password" required>
                                    <i class="fas fa-eye toggle-password"></i>
                                </div>
                                <div class="password-strength">
                                    <div class="strength-bar">
                                        <div class="strength-indicator"></div>
                                    </div>
                                </div>
                                {% if field_errors.password %}
                                    <span class="error-message">{{ field_errors.password }}</span>
                                {% endif %}
                            </div>
                            <div class="form-group {% if field_errors.confirm_password %}has-error{% endif %}">
                                <label for="confirm-password">Confirmer le mot de passe <span class="required">*</span></label>
                                <div class="password-container">
                                    <input type="password" id="confirm-password" name="confirm_password" required>
                                    <i class="fas fa-eye toggle-password"></i>
                                </div>
                                {% if field_errors.confirm_password %}
                                    <span class="error-message">{{ field_errors.confirm_password }}</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
               

                <!-- Boutons de navigation -->
                <div class="form-actions">
                    <button type="button" class="btn-secondary" id="prev-step" style="display: none;">
                        <i class="fas fa-arrow-left"></i> Retour
                    </button>
                    <button type="button" class="btn-primary" id="next-step">
                        Suivant <i class="fas fa-arrow-right"></i>
                    </button>
                    <button type="submit" class="btn-primary" id="submit-form" style="display: none;">
                        <i class="fas fa-check"></i> Créer mon compte
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="{% static 'school_admin/js/inscription_admin.js' %}"></script>

<style>
    /* Styles pour les messages flash */
    .messages-container {
        margin-bottom: 1.5rem;
    }

    .alert {
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 0.95rem;
    }

    .alert-success {
        background-color: #f0fdf4;
        color: #16a34a;
        border: 1px solid #bbf7d0;
    }

    .alert-error {
        background-color: #fef2f2;
        color: #dc2626;
        border: 1px solid #fecaca;
    }

    .alert-warning {
        background-color: #fffbea;
        color: #d97706;
        border: 1px solid #fde68a;
    }

    .alert-info {
        background-color: #eff6ff;
        color: #2563eb;
        border: 1px solid #bae6fd;
    }

    .alert i {
        font-size: 1.25rem;
    }

    /* Styles pour les erreurs de champs */
    .has-error input,
    .has-error select,
    .has-error .file-upload {
        border-color: #dc2626 !important;
        background-color: #fef2f2;
    }

    .error-message {
        color: #dc2626;
        font-size: 0.85rem;
        margin-top: 0.25rem;
        display: block;
    }
</style>
{% endblock %}